<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAP CPI XSLT Executor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 20px; }
        .container { max-width: 1200px; }
        textarea { font-family: monospace; }
        #output { background-color: #f8f9fa; padding: 10px; border-radius: 5px; white-space: pre-wrap; }
    </style>
</head>
<body>
    <div class="container-fluid">
        <h1 class="mb-4">SAP CPI XSLT Executor</h1>

        <div class="row">
            <!-- Left Side -->
            <div class="col-md-3">
                <div class="mb-3">
                    <label for="xmlInput" class="form-label">XML Payload</label>
                    <textarea class="form-control" id="xmlInput" rows="8" placeholder="Enter your XML payload here..."></textarea>
                </div>

                <div class="mb-3">
                    <label for="propertiesInput" class="form-label">Properties (JSON format)</label>
                    <textarea class="form-control" id="propertiesInput" rows="4" placeholder='{"property1": "value1", "property2": "value2"}'></textarea>
                </div>

                <div class="mb-3">
                    <label for="headersInput" class="form-label">Headers (JSON format)</label>
                    <textarea class="form-control" id="headersInput" rows="4" placeholder='{"header1": "value1", "header2": "value2"}'></textarea>
                </div>
            </div>

            <!-- Center -->
            <div class="col-md-4">
                <div class="mb-3">
                    <label for="xsltInput" class="form-label">XSLT Stylesheet</label>
                    <textarea class="form-control" id="xsltInput" rows="15" placeholder="Enter your XSLT stylesheet here..."></textarea>
                </div>

                <div class="mb-3">
                    <label for="console" class="form-label">Console</label>
                    <div id="console" class="form-control" style="height: 200px; overflow-y: auto; background-color: #f8f9fa;"></div>
                </div>

                <button class="btn btn-primary" onclick="transform()">Execute XSLT</button>
            </div>

            <!-- Right Side -->
            <div class="col-md-5">
                <div class="mb-3">
                    <label for="output" class="form-label">Output</label>
                    <div id="output" class="form-control" style="height: 600px; overflow-y: auto;"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function logToConsole(message) {
            const consoleDiv = document.getElementById('console');
            consoleDiv.textContent += new Date().toLocaleTimeString() + ': ' + message + '\n';
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }

        function clearConsole() {
            document.getElementById('console').textContent = '';
        }

        function transform() {
            clearConsole();
            document.getElementById('output').textContent = '';

            const xmlText = document.getElementById('xmlInput').value;
            const xsltText = document.getElementById('xsltInput').value;
            const propertiesText = document.getElementById('propertiesInput').value;
            const headersText = document.getElementById('headersInput').value;

            if (!xmlText || !xsltText) {
                document.getElementById('output').textContent = 'Please provide both XML and XSLT.';
                return;
            }

            try {
                logToConsole('Parsing XML...');
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(xmlText, 'text/xml');

                logToConsole('Parsing XSLT...');
                const xsltDoc = parser.parseFromString(xsltText, 'text/xml');

                logToConsole('Importing stylesheet...');
                const processor = new XSLTProcessor();
                processor.importStylesheet(xsltDoc);

                // Set parameters if provided
                if (propertiesText) {
                    logToConsole('Setting properties as parameters...');
                    const properties = JSON.parse(propertiesText);
                    for (const [key, value] of Object.entries(properties)) {
                        processor.setParameter(null, key, value);
                    }
                }

                if (headersText) {
                    logToConsole('Setting headers as parameters...');
                    const headers = JSON.parse(headersText);
                    for (const [key, value] of Object.entries(headers)) {
                        processor.setParameter(null, key, value);
                    }
                }

                logToConsole('Transforming...');
                const result = processor.transformToDocument(xmlDoc);
                const serializer = new XMLSerializer();
                const output = serializer.serializeToString(result);

                logToConsole('Transformation completed.');
                document.getElementById('output').textContent = output;
            } catch (error) {
                logToConsole('Error: ' + error.message);
                document.getElementById('output').textContent = 'Error: ' + error.message;
            }
        }
    </script>
</body>
</html>
