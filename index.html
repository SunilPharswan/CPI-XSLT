<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAP CPI XSLT Executor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 20px; }
        .container { max-width: 1200px; }
        textarea { font-family: monospace; }
        #output { background-color: #f8f9fa; padding: 10px; border-radius: 5px; white-space: pre-wrap; }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mb-4">SAP CPI XSLT Executor</h1>

        <div class="row mb-3">
            <div class="col-md-6">
                <label for="xmlInput" class="form-label">XML Payload</label>
                <textarea class="form-control" id="xmlInput" rows="10" placeholder="Enter your XML payload here..."></textarea>
            </div>
            <div class="col-md-6">
                <label for="xsltInput" class="form-label">XSLT Stylesheet</label>
                <textarea class="form-control" id="xsltInput" rows="10" placeholder="Enter your XSLT stylesheet here..."></textarea>
            </div>
        </div>

        <div class="mb-3">
            <label for="propertiesInput" class="form-label">Properties (JSON format)</label>
            <textarea class="form-control" id="propertiesInput" rows="3" placeholder='{"property1": "value1", "property2": "value2"}'></textarea>
        </div>

        <div class="mb-3">
            <label for="headersInput" class="form-label">Headers (JSON format)</label>
            <textarea class="form-control" id="headersInput" rows="3" placeholder='{"header1": "value1", "header2": "value2"}'></textarea>
        </div>

        <button class="btn btn-primary mb-3" onclick="transform()">Execute XSLT</button>

        <div class="mb-3">
            <label for="output" class="form-label">Output</label>
            <div id="output" class="form-control" style="height: 300px; overflow-y: auto;"></div>
        </div>
    </div>

    <script>
        function transform() {
            const xmlText = document.getElementById('xmlInput').value;
            const xsltText = document.getElementById('xsltInput').value;
            const propertiesText = document.getElementById('propertiesInput').value;
            const headersText = document.getElementById('headersInput').value;

            if (!xmlText || !xsltText) {
                document.getElementById('output').textContent = 'Please provide both XML and XSLT.';
                return;
            }

            try {
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(xmlText, 'text/xml');
                const xsltDoc = parser.parseFromString(xsltText, 'text/xml');

                const processor = new XSLTProcessor();
                processor.importStylesheet(xsltDoc);

                // Set parameters if provided
                if (propertiesText) {
                    const properties = JSON.parse(propertiesText);
                    for (const [key, value] of Object.entries(properties)) {
                        processor.setParameter(null, key, value);
                    }
                }

                if (headersText) {
                    const headers = JSON.parse(headersText);
                    for (const [key, value] of Object.entries(headers)) {
                        processor.setParameter(null, key, value);
                    }
                }

                const result = processor.transformToDocument(xmlDoc);
                const serializer = new XMLSerializer();
                const output = serializer.serializeToString(result);

                document.getElementById('output').textContent = output;
            } catch (error) {
                document.getElementById('output').textContent = 'Error: ' + error.message;
            }
        }
    </script>
</body>
</html>
